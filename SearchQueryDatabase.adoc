:toc: macro
:numbered:


= C002 Search and query database server with built-in search

toc::[]

== Introduction

*Description:* This is a functional user story, and it will be solved during Iteration 3,
   starting on Wednesday January 24th

*What is included in this task:* test of ACID transactions, REST API, RDF Triples, Bitemporality, Security.

This task can be parallelized with C001

== Understanding ways to communicate

*Common administrative interfaces include:*

* Admin Interface (port 8001)
* Admin API
* Configuration Manager (port 8002)
* Monitoring Dashboards (port 8002)

*Common development interfaces include:*

* Query Console (port 8000)
* XQuery (native)
* JavaScript (native)
* REST API
* Java API
* Node.js API
* XCC

=== http://docs.marklogic.com/guide/admin/forests[Creating a forest using Admin Interface]

A forest can be created through the Admin interface by using the Create tab in the Forests section.
To create a forest in a cluster host, go to
http://192.168.99.100:8001 for hostname ml1.local,
http://192.168.99.100:18001 for hostname ml2.local
and
http://192.168.99.100:28001 for hostname ml3.local

image::imagenes/C002_images/imagen01.png[imagen01.png]
image::imagenes/C002_images/imagen02.png[imagen02.png]

1 - In the Admin Interface (http://localhost:8001), select Forests on the left.

2 - Select the Create tab in the upper middle.

3 - Enter star-wars-1 in the forest name field, to give the forest a name.

4 -Leave the data directory blank, to have the forest created in the default data directory.

5 -Leave the rest of the options with their defaults.

6 -Click the ok button.

7 -If desired, in a command prompt window, enter ls /var/opt/MarkLogic/Forests to view the new forest:

image:imagenes/C002_images/imagen03.png[imagen03.png]

=== http://docs.marklogic.com/guide/admin/databases[Creating a database using Admin Interface]

A database can be created through the Admin interface by using the Create tab in the databases section.

image:imagenes/C002_images/imagen04.png[imagen04.png]
image:imagenes/C002_images/imagen05.png[imagen05.png]

1- In the Admin Interface of the hostname ml1.local, select Databases on the left.

2- Select the Create tab in the upper middle.

3- For database name, enter star-wars.

4- Click the ok button, to create the database.

5- With the database created, click the Database->Forests link.

6- Select the checkbox to the left of the forest name.

7- Click the ok button.

8- To confirm that the forest is attached to the database, click the database name on the left and then click the Status tab.
    See that the number of forests is 1 and that the star-wars-1 forest is listed:

image:imagenes/C002_images/imagen06.png[imagen06.png]


==== Create a second database

1- In the Admin Interface of the hostname ml2.local, under Configure, select Forests.

2- Select the Create tab.

3- Enter playground-1 in the forest name field, to give the forest a name.

4- Leave the data directory blank, to have the forest created in the default data directory.

5- Leave the rest of the options with their defaults.

6- Click the ok button.

7- On the left, select Databases.

8- Select the Create tab.

9- For database name, enter playground.

10- Click the ok button, to create the database.

11- With the database created, click the Database->Forests link.

12- Select the checkbox to the left of playground-1.

13- Click the ok button.

14- To confirm that the forest is attached to the database, click the database name on the left and then click the Status tab.
    See that the number of forests is 1 and that the playground-1 forest is listed:

image:imagenes/C002_images/imagen07.png[imagen07.png]


=== Creating databases and forests using Query Console

Query Console is a web-based MarkLogic interface, available at port 8000(ml1.local),18000(ml2.local) and 28000(ml3.local) respectively, that allows you to execute JavaScript or XQuery expressions in MarkLogic.

1- Go to http://192.168.99.100:28000
2- See that you are viewing Query Console
image:imagenes/C002_images/imagen08.png[imagen08.png]
3- In the Content Source drop-down list, view the list of databases that already exist (playground was created on ml2.local)
ce
image:imagenes/C002_images/imagen09.png[imagen09.png]
4- In the Query Type drop-down list, notice the query languages:

image:imagenes/C002_images/imagen11.png[imagen08.png]

5- Now, use the admin API to define a forest named top-songs-1, a databases named top-songs, and then attaches the forest to the database.
Write this Javascript code in the query console:

    var admin = require('/MarkLogic/admin.xqy');

    var forestConfig = admin.getConfiguration();
    forestConfig = admin.forestCreate(forestConfig, 'top-songs-1', xdmp.host(), '', '', '');
    admin.saveConfiguration(forestConfig);

    var dbConfig = admin.getConfiguration();
    dbConfig = admin.databaseCreate(dbConfig, 'top-songs', xdmp.database('Security'), xdmp.database('Schemas'));
    admin.saveConfiguration(dbConfig);

    var forestAttachConfig = admin.getConfiguration();
    forestAttachConfig = admin.databaseAttachForest(forestAttachConfig, xdmp.database('top-songs'), xdmp.forest('top-songs-1'));
    admin.saveConfiguration(forestAttachConfig);

6- In Query Console, check that you have JavaScript selected as the Query Type.

image:imagenes/C002_images/imagen10.png[imagen10.png]

7- Realize that, for this code (which is defining a new database), the database selected in the Content Source list is irrelevant.

8- Click the Run button, to execute the code.

9- Realize that the return message of your query response was empty is expected, because you did not retrieve any documents from the selected database.

10- Reload the browser page (F5)

11- Look in the Content Source list to see that the top-songs database now appears in the list:

image:imagenes/C002_images/imagen12.png[imagen12.png]


=== Creating databases and forests using REST API



== Inserting Data into a Database

== Search
== Indexes
== Security
